<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snake of Knowledge</title>
  <style>
    :root{
      --bg:#0b1220;          /* deep navy */
      --panel:#121b2e;       /* panel bg */
      --accent:#49a6ff;      /* cyan-blue */
      --accent-2:#8ef0a5;    /* mint */
      --danger:#ff6b6b;      /* coral */
      --text:#e8f1ff;        /* near-white */
      --muted:#a8b3c7;       /* muted text */
      --grid:#1a2947;        /* grid lines */
      --gem:#ffd166;         /* gem color */
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#0d1527);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{display:grid;grid-template-columns:1fr 360px;gap:16px;max-width:1080px;margin:24px auto;padding:16px}
    @media (max-width: 900px){.wrap{grid-template-columns:1fr}}

    .card{background:var(--panel);border:1px solid #1f2a48;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
    .game{position:relative;aspect-ratio:4/3;min-height:360px}
    #board{width:100%;height:100%;display:block;border-radius:16px}
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;background:rgba(9,14,27,.55);backdrop-filter:blur(2px);border-radius:16px}
    .overlay.hidden{display:none}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid #2a3a66;background:#152243;color:var(--text);cursor:pointer;font-weight:600}
    .btn:hover{border-color:var(--accent);box-shadow:0 0 0 2px rgba(73,166,255,.25) inset}
    .primary{background:linear-gradient(180deg,var(--accent),#2f86e1);border-color:#2f86e1;color:black}

    .side{padding:16px;display:flex;flex-direction:column;gap:16px}
    h1{font-size:20px;margin:8px 0 0}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .pill{padding:6px 10px;border-radius:999px;background:#0f1a33;border:1px solid #223158;color:var(--muted);font-size:12px}
    .score{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
    .stat{padding:10px;border-radius:10px;background:#0e1933;border:1px solid #223158;text-align:center}
    .stat b{display:block;font-size:18px;color:var(--accent)}

    .fact{position:relative;padding:12px 14px;border-radius:12px;border:1px solid #224066;background:linear-gradient(180deg,#0e1e3d,#0b1a33);box-shadow:0 6px 14px rgba(0,0,0,.2)}
    .fact h3{margin:0 0 6px;font-size:14px;color:var(--accent-2)}
    .muted{color:var(--muted);font-size:13px}

    .kbd{padding:2px 6px;border:1px solid #344b7a;border-bottom-width:3px;border-radius:6px;background:#0e1830;color:#b9c7e6;font-family:ui-monospace,Monaco,Menlo,Consolas,monospace}
    .controls li{margin:4px 0}

    .toggle{display:inline-flex;align-items:center;gap:8px}
    input[type="checkbox"]{width:40px;height:22px;appearance:none;background:#243556;border-radius:999px;position:relative;outline:none;cursor:pointer;border:1px solid #2a3a66}
    input[type="checkbox"]::after{content:"";position:absolute;top:2px;left:2px;width:18px;height:18px;border-radius:50%;background:#bcd7ff;transition:.2s}
    input[type="checkbox"]:checked{background:#204b3a}
    input[type="checkbox"]:checked::after{left:20px;background:#9ff0b5}

    .legend{display:flex;gap:10px;flex-wrap:wrap}
    .legend span{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:#b6c5de}
    .box{width:14px;height:14px;border-radius:4px;border:1px solid #0003}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card game">
      <canvas id="board" width="800" height="600" aria-label="Snake game canvas" role="img"></canvas>
      <div id="overlayStart" class="overlay" aria-live="polite">
        <h2 style="margin:0">üêç Snake of Knowledge</h2>
        <p class="muted" style="margin:0 0 6px">Collect <b>Knowledge Gems</b> to learn quick facts!</p>
        <div class="legend">
          <span><span class="box" style="background:#38bdf8"></span> Snake</span>
          <span><span class="box" style="background:var(--gem)"></span> Gem</span>
          <span><span class="box" style="background:#6ee7b7"></span> Trail</span>
        </div>
        <div class="row">
          <button class="btn primary" id="btnStart">Start Game</button>
          <button class="btn" id="btnReset">Reset</button>
        </div>
        <small class="muted">Controls: <span class="kbd">‚Üë‚Üì‚Üê‚Üí</span> or <span class="kbd">WASD</span>, <span class="kbd">P</span> Pause, <span class="kbd">R</span> Reset</small>
      </div>
      <div id="overlayPause" class="overlay hidden"><h3>Paused</h3><button class="btn primary" id="btnResume">Resume</button></div>
      <div id="overlayGameOver" class="overlay hidden"><h3>Game Over</h3><p class="muted" id="finalStats"></p><button class="btn primary" id="btnPlayAgain">Play Again</button></div>
    </div>

    <aside class="card side" aria-label="Game side panel">
      <header>
        <h1>Teacher Tweaks</h1>
        <p class="muted" style="margin:6px 0 0">Edit the <b>facts</b>, grid, and speed settings in the code (top of JS section).
        </p>
      </header>

      <section class="score" aria-live="polite">
        <div class="stat" title="Score"><span class="muted">Score</span><b id="uiScore">0</b></div>
        <div class="stat" title="Level"><span class="muted">Level</span><b id="uiLevel">1</b></div>
      </section>

      <section class="fact" id="factPanel" aria-live="polite" aria-atomic="true">
        <h3>üí° Fact of the moment</h3>
        <div id="factText" class="muted">Collect a gem to see a quick fact.</div>
      </section>

      <section>
        <div class="row controls">
          <div class="toggle"><input id="soundToggle" type="checkbox" aria-label="Sound effects"/><label for="soundToggle">Sound</label></div>
          <button class="btn" id="btnPause" aria-pressed="false">Pause <span class="kbd">P</span></button>
          <button class="btn" id="btnReset2">Reset <span class="kbd">R</span></button>
        </div>
      </section>
      <section>
        <h2 style="font-size:16px;margin:8px 0">How to play</h2>
        <ul class="muted" style="padding-left:18px;margin:6px 0">
          <li>Use arrows or WASD to move the snake.</li>
          <li>Collect gems to score and reveal a rotating fact.</li>
          <li>Every 3 gems the speed increases slightly.</li>
          <li>Don't crash into walls or your tail!</li>
        </ul>
      </section>
    </aside>
  </div>

  <script>
  // =============================
  //  TEACHER TWEAKS (easy edits)
  // =============================
  const FACT_TOPIC = "Photosynthesis"; // Change topic title
  const FACTS = [
    "Plants make food in leaves using sunlight, water, and CO‚ÇÇ.",
    "Chlorophyll gives leaves their green color and absorbs light.",
    "Stomata are tiny pores on leaves that let gases in and out.",
    "Water travels from roots to leaves through xylem.",
    "Glucose stores energy; oxygen is released to the air.",
    "Sunlight energy is converted into chemical energy.",
    "Photosynthesis mostly happens in the palisade cells.",
    "In the dark, photosynthesis stops but respiration continues.",
    "Chloroplasts are the cell parts where photosynthesis occurs.",
    "Plants need minerals (like magnesium) to build chlorophyll."
  ];
  const GRID_COLS = 32;         // horizontal cells
  const GRID_ROWS = 24;         // vertical cells
  const START_SPEED_MS = 140;   // lower = faster
  const SPEED_STEP_MS = 8;      // speed up per level
  const GEMS_PER_LEVEL = 3;     // gems to level up

  // Colors
  const COLOR_BG = getCSSVar('--panel');
  const COLOR_GRID = getCSSVar('--grid');
  const COLOR_SNAKE = '#38bdf8';
  const COLOR_TRAIL = '#6ee7b7';
  const COLOR_GEM = getCSSVar('--gem');

  function getCSSVar(name){
    return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
  }

  // =============================
  //  GAME STATE
  // =============================
  const canvas = document.getElementById('board');
  const ctx = canvas.getContext('2d');
  let cellW, cellH;

  let state;
  const Direction = {Up:0, Right:1, Down:2, Left:3};
  const keyMap = new Map([
    ['ArrowUp', Direction.Up], ['KeyW', Direction.Up],
    ['ArrowRight', Direction.Right], ['KeyD', Direction.Right],
    ['ArrowDown', Direction.Down], ['KeyS', Direction.Down],
    ['ArrowLeft', Direction.Left], ['KeyA', Direction.Left]
  ]);

  function initState(){
    const start = {x: Math.floor(GRID_COLS/2), y: Math.floor(GRID_ROWS/2)};
    return {
      snake: [start, {x:start.x-1,y:start.y}, {x:start.x-2,y:start.y}],
      dir: Direction.Right,
      nextDir: Direction.Right,
      gem: spawnGem(new Set()),
      score: 0,
      level: 1,
      eaten: 0,
      alive: true,
      paused: true,
      tickMs: START_SPEED_MS,
    };
  }

  function posKey(p){return p.x+','+p.y}
  function spawnGem(occupied){
    let p;
    do {
      p = {x: Math.floor(Math.random()*GRID_COLS), y: Math.floor(Math.random()*GRID_ROWS)};
    } while (occupied.has(posKey(p)));
    return p;
  }

  function resizeCanvas(){
    // Maintain 4:3 ratio while fitting container
    const rect = canvas.parentElement.getBoundingClientRect();
    const targetW = rect.width;
    const targetH = rect.height;
    canvas.width = Math.max(640, Math.floor(targetW));
    canvas.height = Math.max(480, Math.floor(targetH));
    cellW = Math.floor(canvas.width / GRID_COLS);
    cellH = Math.floor(canvas.height / GRID_ROWS);
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // =============================
  //  SOUND (simple beeps)
  // =============================
  let audioCtx = null; // lazily created
  const soundToggle = document.getElementById('soundToggle');
  function beep(freq=600, dur=0.07, type='sine'){
    if(!soundToggle.checked) return;
    if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = type; o.frequency.value = freq; o.connect(g); g.connect(audioCtx.destination);
    g.gain.setValueAtTime(0.02, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime+dur);
    o.start(); o.stop(audioCtx.currentTime+dur);
  }

  // =============================
  //  UI ELEMENTS
  // =============================
  const uiScore = document.getElementById('uiScore');
  const uiLevel = document.getElementById('uiLevel');
  const factText = document.getElementById('factText');
  const overlayStart = document.getElementById('overlayStart');
  const overlayPause = document.getElementById('overlayPause');
  const overlayGameOver = document.getElementById('overlayGameOver');
  const finalStats = document.getElementById('finalStats');

  document.getElementById('btnStart').addEventListener('click', ()=>{ state.paused=false; overlayStart.classList.add('hidden'); canvas.focus(); loop(); });
  document.getElementById('btnReset').addEventListener('click', resetGame);
  document.getElementById('btnReset2').addEventListener('click', resetGame);
  document.getElementById('btnPause').addEventListener('click', togglePause);
  document.getElementById('btnResume').addEventListener('click', togglePause);
  document.getElementById('btnPlayAgain').addEventListener('click', ()=>{ overlayGameOver.classList.add('hidden'); resetGame(); state.paused=false; loop(); });

  let factTimer = null;
  function showFact(){
    const fact = FACTS[Math.floor(Math.random()*FACTS.length)];
    factText.textContent = `(${FACT_TOPIC}) ${fact}`;
    clearTimeout(factTimer);
    factTimer = setTimeout(()=>{ factText.textContent = 'Collect a gem to see a quick fact.'; }, 5200);
  }

  // =============================
  //  INPUT
  // =============================
  window.addEventListener('keydown', (e)=>{
    if(e.code === 'KeyP'){ togglePause(); return; }
    if(e.code === 'KeyR'){ resetGame(); return; }
    const d = keyMap.get(e.code);
    if(d===undefined) return;
    // prevent immediate 180¬∞
    if(Math.abs(d - state.dir) === 2) return;
    state.nextDir = d;
  });

  // =============================
  //  GAME LOOP
  // =============================
  let rafId = null, lastTick = 0;
  function loop(ts=0){
    if(!state.alive){ return; }
    if(state.paused){ draw(); return; }
    rafId = requestAnimationFrame(loop);
    if(ts - lastTick >= state.tickMs){
      lastTick = ts;
      step();
      draw();
    }
  }

  function step(){
    // advance snake
    state.dir = state.nextDir;
    const head = {...state.snake[0]};
    if(state.dir===Direction.Up) head.y -= 1;
    else if(state.dir===Direction.Right) head.x += 1;
    else if(state.dir===Direction.Down) head.y += 1;
    else head.x -= 1;

    // wall collision
    if(head.x<0 || head.y<0 || head.x>=GRID_COLS || head.y>=GRID_ROWS){
      gameOver(); return;
    }
    // tail collision
    const occ = new Set(state.snake.map(posKey));
    if(occ.has(posKey(head))){ gameOver(); return; }

    state.snake.unshift(head);

    // gem eaten?
    if(head.x===state.gem.x && head.y===state.gem.y){
      state.score += 10;
      state.eaten += 1;
      uiScore.textContent = state.score;
      beep(700, .06, 'triangle');
      showFact();
      // speed up
      if(state.eaten % GEMS_PER_LEVEL === 0){
        state.level += 1; uiLevel.textContent = state.level;
        state.tickMs = Math.max(60, state.tickMs - SPEED_STEP_MS);
        beep(900, .08, 'sawtooth');
      }
      // spawn new gem
      const occ2 = new Set(state.snake.map(posKey));
      state.gem = spawnGem(occ2);
    } else {
      state.snake.pop();
    }
  }

  function draw(){
    // background
    ctx.fillStyle = COLOR_BG; ctx.fillRect(0,0,canvas.width,canvas.height);

    // grid
    ctx.strokeStyle = COLOR_GRID; ctx.lineWidth = 1;
    ctx.beginPath();
    for(let x=0;x<=GRID_COLS;x++){ ctx.moveTo(x*cellW+0.5,0); ctx.lineTo(x*cellW+0.5,canvas.height); }
    for(let y=0;y<=GRID_ROWS;y++){ ctx.moveTo(0,y*cellH+0.5); ctx.lineTo(canvas.width,y*cellH+0.5); }
    ctx.stroke();

    // gem
    drawCell(state.gem.x, state.gem.y, COLOR_GEM, 4);

    // snake
    state.snake.forEach((p,i)=>{
      const c = i===0 ? COLOR_SNAKE : COLOR_TRAIL;
      drawCell(p.x, p.y, c, i===0?2:3);
    });
  }

  function drawCell(cx,cy,color,r=3){
    const x = cx*cellW, y = cy*cellH;
    const pad = Math.max(2, Math.min(cellW,cellH)*0.08*r/3);
    ctx.fillStyle = color;
    roundRect(ctx, x+pad, y+pad, cellW-2*pad, cellH-2*pad, 6);
    ctx.fill();
  }
  function roundRect(ctx,x,y,w,h,r){
    ctx.beginPath();
    ctx.moveTo(x+r,y);
    ctx.arcTo(x+w,y,x+w,y+h,r);
    ctx.arcTo(x+w,y+h,x,y+h,r);
    ctx.arcTo(x,y+h,x,y,r);
    ctx.arcTo(x,y,x+w,y,r);
    ctx.closePath();
  }

  function togglePause(){
    if(!state.alive) return;
    state.paused = !state.paused;
    document.getElementById('btnPause').setAttribute('aria-pressed', state.paused?'true':'false');
    overlayPause.classList.toggle('hidden', !state.paused);
    if(!state.paused){
      lastTick = 0; loop();
    }
  }

  function gameOver(){
    state.alive = false; beep(200,.12,'square');
    finalStats.textContent = `Score ${state.score} ‚Ä¢ Level ${state.level}`;
    overlayGameOver.classList.remove('hidden');
  }

  function resetGame(){
    cancelAnimationFrame(rafId); state = initState();
    uiScore.textContent = '0'; uiLevel.textContent = '1';
    overlayStart.classList.remove('hidden');
    overlayPause.classList.add('hidden');
    overlayGameOver.classList.add('hidden');
    factText.textContent = 'Collect a gem to see a quick fact.';
    draw();
  }

  // boot
  state = initState();
  draw();
  </script>
</body>
</html>
